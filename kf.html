<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>世界环境保护组织客服中心 | WEPO Customer Service</title>
    <link rel="icon" href="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEBGgZoupS08tmL4sCb3NLCDl0z9vLmgQACXCEAAi5q2VU7eyZzJwjEpDYE.jpeg" type="image/jpeg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --deep-blue: #0a1f3d;
            --deep-purple: #3a0a4d;
            --light-blue: #1a3b6d;
            --light-purple: #5a1a7d;
            --text-light: #f0f0f0;
            --text-dark: #333333;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--deep-blue), var(--deep-purple));
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 50px;
            margin-right: 15px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin: 0;
            font-weight: 600;
        }
        
        .language-switch {
            display: flex;
            gap: 10px;
        }
        
        .language-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-light);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .language-btn.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }
        
        .language-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 180px);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .chat-header {
            background: linear-gradient(90deg, var(--light-blue), var(--light-purple));
            padding: 15px 20px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-radius: 15px;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4a6fa5, #6a4a95);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 5px;
        }
        
        .ai-message-content {
            overflow: hidden;
        }
        
        .chat-input-area {
            display: flex;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 1rem;
            outline: none;
        }
        
        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .send-btn {
            background: linear-gradient(135deg, var(--light-blue), var(--light-purple));
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0 25px;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .send-btn:hover {
            background: linear-gradient(135deg, #2a5b9d, #4a2a7d);
        }
        
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
            gap: 10px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-light);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--deep-blue), var(--deep-purple));
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-light);
        }
        
        .modal-text {
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-close {
            background: linear-gradient(135deg, var(--light-blue), var(--light-purple));
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: linear-gradient(135deg, #2a5b9d, #4a2a7d);
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 15px;
            border-bottom-left-radius: 5px;
            margin-bottom: 15px;
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .logo img {
                height: 40px;
            }
            
            .chat-container {
                height: calc(100vh - 150px);
            }
            
            .message {
                max-width: 90%;
            }
            
            .chat-input-area {
                padding: 10px;
            }
            
            .chat-input {
                padding: 10px 15px;
            }
            
            .send-btn {
                padding: 0 20px;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .logo img {
                margin-right: 0;
                margin-bottom: 5px;
                height: 35px;
            }
            
            .language-switch {
                margin-top: 10px;
            }
            
            .chat-header {
                padding: 10px 15px;
                font-size: 1rem;
            }
            
            .chat-messages {
                padding: 15px;
            }
            
            .message {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEBGgZoupS08tmL4sCb3NLCDl0z9vLmgQACXCEAAi5q2VU7eyZzJwjEpDYE.jpeg" alt="WEPO Logo">
                <h1 id="header-title">世界环境保护组织客服中心</h1>
            </div>
            <div class="language-switch">
                <button class="language-btn active" id="zh-btn">中文</button>
                <button class="language-btn" id="en-btn">English</button>
            </div>
        </header>
        
        <div class="chat-container">
            <div class="chat-header" id="chat-header">
                世界环境保护组织智能客服
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message ai-message">
                    <div class="ai-message-content">
                        您好！这里是世界环境保护组织(WEPO)客服中心。我是您的智能助手，很高兴为您服务。请问有什么可以帮您的？
                    </div>
                </div>
            </div>
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="user-input" placeholder="请输入您的问题..." autocomplete="off">
                <button class="send-btn" id="send-btn">发送</button>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="action-btn" id="transfer-btn">转人工客服</button>
            <button class="action-btn" id="clear-btn">清空对话</button>
        </div>
    </div>
    
    <div class="modal" id="transfer-modal">
        <div class="modal-content">
            <h2 class="modal-title" id="modal-title">转人工客服</h2>
            <p class="modal-text" id="modal-text">
                如需人工客服帮助，请扫描下方二维码或搜索微信公众号"WEPO2021"进行咨询。<br><br>
                <img src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEBhd9ovas2gMczMbioo3vHLFa0849z2gACdxwAAn6U6VVN9Kmr_hKPGjYE.jpg" alt="WEPO WeChat QR Code" style="max-width: 150px; margin: 10px auto;">
            </p>
            <button class="modal-close" id="modal-close">关闭</button>
        </div>
    </div>
    
    <script>
        // 系统配置
        const config = {
            apiKey: "sk-8e3711b5de224d068a2f08430d59b75e",
            apiUrl: "https://api.deepseek.com/v1/chat/completions",
            systemPrompt: {
                zh: "你是世界环境保护组织(WEPO)的官方客服代表。你的职责是回答关于环境保护、可持续发展、气候变化、生态保护等相关问题。请以专业、友好且权威的语气回答用户的问题。如果遇到不确定的问题，不要编造信息，而是建议用户通过官方渠道获取更多信息。WEPO官方网站是wepo.top  官方微信公众号是WEPO2021",
                en: "You are an official customer service representative of the World Environmental Protection Organization (WEPO). Your responsibility is to answer questions about environmental protection, sustainable development, climate change, ecological conservation, and related topics. Please respond to user inquiries in a professional, friendly, and authoritative manner. If you encounter questions you're unsure about, do not fabricate information; instead, advise users to obtain more details through official channels."
            },
            welcomeMessage: {
                zh: "您好！这里是世界环境保护组织(WEPO)客服中心。我是您的智能助手，很高兴为您服务。请问有什么可以帮您的？",
                en: "Hello! This is the World Environmental Protection Organization (WEPO) customer service center. I am your intelligent assistant, pleased to be of service. How may I assist you today?"
            }
        };
        
        // DOM元素
        const elements = {
            chatMessages: document.getElementById('chat-messages'),
            userInput: document.getElementById('user-input'),
            sendBtn: document.getElementById('send-btn'),
            transferBtn: document.getElementById('transfer-btn'),
            clearBtn: document.getElementById('clear-btn'),
            zhBtn: document.getElementById('zh-btn'),
            enBtn: document.getElementById('en-btn'),
            transferModal: document.getElementById('transfer-modal'),
            modalClose: document.getElementById('modal-close'),
            typingIndicator: document.getElementById('typing-indicator'),
            headerTitle: document.getElementById('header-title'),
            chatHeader: document.getElementById('chat-header'),
            modalTitle: document.getElementById('modal-title'),
            modalText: document.getElementById('modal-text')
        };
        
        // 当前语言状态 (默认中文)
        let currentLanguage = 'zh';
        let currentAiMessage = null;
        
        // 初始化
        function init() {
            // 事件监听
            elements.sendBtn.addEventListener('click', sendMessage);
            elements.userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            elements.transferBtn.addEventListener('click', showTransferModal);
            elements.clearBtn.addEventListener('click', clearChat);
            elements.zhBtn.addEventListener('click', () => switchLanguage('zh'));
            elements.enBtn.addEventListener('click', () => switchLanguage('en'));
            elements.modalClose.addEventListener('click', hideTransferModal);
            
            // 初始化欢迎消息
            updateUIForLanguage();
        }
        
        // 发送消息
        async function sendMessage() {
            const userMessage = elements.userInput.value.trim();
            if (!userMessage) return;
            
            // 添加用户消息到聊天界面
            addMessage(userMessage, 'user');
            elements.userInput.value = '';
            
            // 显示"正在输入"指示器
            elements.typingIndicator.style.display = 'flex';
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            // 创建AI消息容器
            currentAiMessage = createAiMessageContainer();
            
            try {
                // 调用DeepSeek API
                await callDeepSeekAPIStream(userMessage);
            } catch (error) {
                // 隐藏"正在输入"指示器
                elements.typingIndicator.style.display = 'none';
                
                // 显示错误消息
                const errorMessage = currentLanguage === 'zh' 
                    ? "抱歉，暂时无法处理您的请求。请稍后再试或通过微信公众号联系我们。" 
                    : "Sorry, we're unable to process your request at the moment. Please try again later or contact us via WeChat official account.";
                
                updateAiMessage(errorMessage);
                console.error('API调用失败:', error);
            } finally {
                // 隐藏"正在输入"指示器
                elements.typingIndicator.style.display = 'none';
                currentAiMessage = null;
            }
        }
        
        // 创建AI消息容器
        function createAiMessageContainer() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'ai-message-content';
            
            messageDiv.appendChild(contentDiv);
            elements.chatMessages.appendChild(messageDiv);
            
            // 滚动到底部
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            return contentDiv;
        }
        
        // 更新AI消息内容
        function updateAiMessage(content) {
            if (currentAiMessage) {
                currentAiMessage.innerHTML = marked.parse(content);
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            }
        }
        
        // 调用DeepSeek API (流式)
        async function callDeepSeekAPIStream(userMessage) {
            const response = await fetch(config.apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${config.apiKey}`
                },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [
                        {
                            role: "system",
                            content: currentLanguage === 'en' 
                                ? `${config.systemPrompt.en} Respond in English.`
                                : config.systemPrompt.zh
                        },
                        {
                            role: "assistant",
                            content: currentLanguage === 'en' 
                                ? config.welcomeMessage.en 
                                : config.welcomeMessage.zh
                        },
                        {
                            role: "user",
                            content: userMessage
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 1000,
                    stream: true  // 启用流式输出
                })
            });
            
            if (!response.ok) {
                throw new Error(`API请求失败: ${response.status}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let fullResponse = '';
            
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                
                const chunk = decoder.decode(value);
                const lines = chunk.split('\n').filter(line => line.trim() !== '');
                
                for (const line of lines) {
                    if (line.startsWith('data:') && !line.includes('[DONE]')) {
                        try {
                            const data = JSON.parse(line.substring(5));
                            if (data.choices && data.choices[0].delta && data.choices[0].delta.content) {
                                fullResponse += data.choices[0].delta.content;
                                updateAiMessage(fullResponse);
                            }
                        } catch (e) {
                            console.error('解析流数据失败:', e);
                        }
                    }
                }
            }
            
            return fullResponse;
        }
        
        // 添加消息到聊天界面
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = `${sender}-message-content`;
            
            // 使用marked.js解析Markdown
            contentDiv.innerHTML = marked.parse(content);
            
            messageDiv.appendChild(contentDiv);
            elements.chatMessages.appendChild(messageDiv);
            
            // 滚动到底部
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }
        
        // 显示转人工弹窗
        function showTransferModal() {
            elements.transferModal.style.display = 'flex';
        }
        
        // 隐藏转人工弹窗
        function hideTransferModal() {
            elements.transferModal.style.display = 'none';
        }
        
        // 清空聊天
        function clearChat() {
            elements.chatMessages.innerHTML = '';
            
            // 添加新的欢迎消息
            const welcomeMessage = currentLanguage === 'en' 
                ? config.welcomeMessage.en 
                : config.welcomeMessage.zh;
            
            addMessage(welcomeMessage, 'ai');
        }
        
        // 切换语言
        function switchLanguage(lang) {
            if (currentLanguage === lang) return;
            
            currentLanguage = lang;
            updateUIForLanguage();
            
            // 更新语言按钮状态
            elements.zhBtn.classList.toggle('active', lang === 'zh');
            elements.enBtn.classList.toggle('active', lang === 'en');
            
            // 清空并重新开始对话
            clearChat();
        }
        
        // 根据当前语言更新UI文本
        function updateUIForLanguage() {
            if (currentLanguage === 'zh') {
                elements.headerTitle.textContent = '世界环境保护组织客服中心';
                elements.chatHeader.textContent = '世界环境保护组织智能客服';
                elements.userInput.placeholder = '请输入您的问题...';
                elements.sendBtn.textContent = '发送';
                elements.transferBtn.textContent = '转人工客服';
                elements.clearBtn.textContent = '清空对话';
                elements.modalTitle.textContent = '转人工客服';
                elements.modalText.innerHTML = '如需人工客服帮助，请扫描下方二维码或搜索微信公众号"WEPO2021"进行咨询。<br><br><img src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEBhd9ovas2gMczMbioo3vHLFa0849z2gACdxwAAn6U6VVN9Kmr_hKPGjYE.jpg" alt="WEPO WeChat QR Code" style="max-width: 150px; margin: 10px auto;">';
                elements.modalClose.textContent = '关闭';
            } else {
                elements.headerTitle.textContent = 'WEPO Customer Service';
                elements.chatHeader.textContent = 'WEPO Intelligent Assistant';
                elements.userInput.placeholder = 'Please enter your question...';
                elements.sendBtn.textContent = 'Send';
                elements.transferBtn.textContent = 'Transfer to Agent';
                elements.clearBtn.textContent = 'Clear Chat';
                elements.modalTitle.textContent = 'Transfer to Agent';
                elements.modalText.innerHTML = 'For assistance from a human agent, please scan the QR code below or search for the WeChat official account "WEPO2021".<br><br><img src="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAAEBhd9ovas2gMczMbioo3vHLFa0849z2gACdxwAAn6U6VVN9Kmr_hKPGjYE.jpg" alt="WEPO WeChat QR Code" style="max-width: 150px; margin: 10px auto;">';
                elements.modalClose.textContent = 'Close';
            }
        }
        
        // 初始化应用
        window.onload = init;
    </script>
</body>
</html>
